/*
 * main.c
 *
 *  Created on: 10 gru 2016
 *      Author: Mat
 */
#include "avr/io.h"
#include "avr/pgmspace.h"
#include "avr/interrupt.h"
#include "avr/delay.h"
#include "string.h"
#include "utils.h"

/* DATA */
static volatile uint16 debugADCread = 0;

/* FUNCTIONS */
static void init()
{
	DDRB = 0xFF; /* DDR.1 output  */
	DDRC = 0x00; /* DDR.0 - input */
	DDRD = 0xFE;
	//EMPTY_INTERRUPT(ADC_vect);
	initADC();
	sei();
}

static void initADC()
{
	ADCSRA = (1<<ADEN)     // ADEN=1 enable ADC
	         |(1<<ADPS0)   // set prescaler to 128
	         |(1<<ADPS1)
	         |(1<<ADPS2)
             |(1<<ADIE);   // enable ADC_vect
}

ISR(ADC_vect)
{
	debugADCread = ADLAR;
	TOGGLE_PIN(PORTC,PC5);

}

int main (int argc, char **argv)
{
	init();
	while (TRUE)
	{
		TOGGLE_PIN(PORTC,PC5);
		_delay_ms(500);
	}
	return 0;
}
